<!doctype html>
<html>
  <head>
    <link rel="stylesheet/less" type="text/css" href="main.less">
    <script src="less.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Droid+Serif' rel='stylesheet' type='text/css'>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>webjs - Simple and stable development for Node.js</title>
    <script type="text/javascript">
      (function () {
        if (/Microsoft/.test(navigator.appName)) { return }
        window.onload = function () {
          var headers = document.querySelectorAll('#docs h2, #guide h1');
          var menu = document.getElementById('menu');
          var init = menu.offsetTop;
          var docked;
          window.onscroll = function () {
            if (!docked && (menu.offsetTop - scrollTop() < 0)) {
              menu.style.top = 0;
              menu.style.position = 'fixed';
              menu.className = 'docked';
              docked = true;
            } else if (docked && scrollTop() <= init) {
              menu.style.position = 'absolute';
              menu.style.top = init + 'px';
              menu.className = menu.className.replace('docked', '');
              docked = false;
            }
          };
          (function () {
            var synopsis_link     = document.getElementById('synopsis-link'),
                synopsis_dropdown = document.getElementById('synopsis-dropdown');
            synopsis_link.onmouseover = function () {
              synopsis_link.className = 'dark-red';
              synopsis_dropdown.style.display = 'block';
            };
            synopsis_link.onmouseout = function (e) {
              if (e.relatedTarget === synopsis_dropdown) { return }
              synopsis_link.className = synopsis_link.className.replace('dark-red', '');
              synopsis_hide ();
            };
            synopsis_dropdown.onmouseout = function (e) {
              var t = e.relatedTarget;

              if (e.target == synopsis_link) { return }

              while (t !== document.body) {
                if (t == synopsis_dropdown) { return }
                else               { t = t.parentNode }
              } 
              synopsis_link.className = synopsis_link.className.replace('dark-red', '');
              synopsis_hide ();
            };
            function synopsis_hide() { synopsis_dropdown.style.display = 'none' }

            var guide_link     = document.getElementById('guide-link'),
                guide_dropdown = document.getElementById('guide-dropdown');
            guide_link.onmouseover = function () {
              guide_link.className = 'dark-red';
              guide_dropdown.style.display = 'block';
            };
            guide_link.onmouseout = function (e) {
              if (e.relatedTarget === guide_dropdown) { return }
              guide_link.className = guide_link.className.replace('dark-red', '');
              guide_hide ();
            };
            guide_dropdown.onmouseout = function (e) {
              var t = e.relatedTarget;

              if (e.target == guide_link) { return }

              while (t !== document.body) {
                if (t == guide_dropdown) { return }
                else               { t = t.parentNode }
              } 
              guide_link.className = guide_link.className.replace('dark-red', '');
              guide_hide ();
            };
            function guide_hide() { guide_dropdown.style.display = 'none' }
          })();
        };

        function scrollTop() {
          return document.body.scrollTop || document.documentElement.scrollTop;
        }
      })();
    </script>
  </head>
  <body>
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/iwillwen/webjs">Fork Me on GitHub</a>

          <h1 id="project_title" style="display:inline-block">webjs</h1>
          <h2 id="project_tagline" style="display:inline-block;font-size:15px">version 0.5.3</h2>
          <h2 id="project_tagline">Simple and stable development for Node.js</h2>
          <h3>
            webjs makes your websites' and web apps' <span>server-side</span> script <span>simplier</span>, <span>faster</span>, <span>more stable</span> and <span>more readable</span>.
          </h3>
        </header>
    </div>
    <section>

<section id="menu">
  <div class="content">
    <nav>
      <a href="#synopsis" id="synopsis-link">Synopsis</a>
      <a href="#guide" id="guide-link">Guide</a>
      <a href="#usage">Usage</a>
      <a href="http://github.com/iwillwen/webjs">Soures</a>
      <a href="#about">About</a>
    </nav>
  </div>
  <div class="dropdown" id="synopsis-dropdown">
    <ul>
      <li><a href="#-server">Server</a></li>
      <li><a href="#-config">Config</a></li>
      <li><a href="#-router">Router</a></li>
      <li><a href="#-cli">CLI</a></li>
    </ul>
  </div>
  <div class="dropdown" id="guide-dropdown">
    <ul>
      <li><a href="#-installation">Installation</a></li>
    </ul>
  </div>
</section>

<section id="synopsis" class="page">
  <div class="content">
    <div class="space-20" id="-server"></div>
    <h2>Server</h2>
    <p>First, we need to run a new server. You can use the web controller or create app.</p>
    <pre><code>var web = require('webjs');
//Use the web controller
web.run()
   .use(web.static(__dirname));

//Create a app like connect
var app = web.create()
    //default create a http server.
    //you can set the first argument like 'https' or 'net'.
    .use(web.static(__dirname))
    .listen(8080);</code></pre>

  <div class="space-20" id="-config"></div>
  <h2>Config</h2>
  <p>After run a server, we need to config it.</p>
  <pre><code>web.run()
   .use(web.static(__dirname + '/../static'))
   .config({
     'views': __dirname + '/../views',
     'view engine': 'jade',
     'readonly': false,
     'mode': 'dev'
   });</code></pre>

  <div class="space-20" id="-router"></div>
  <h2>Router</h2>
  <p>Router is webjs's core. We can use it to build a true web app.</p>
  <pre><code>web.get({
  '/': function (req, res) {
    res.render('index', {
      title: 'Index',
      local: {
        name: 'webjs'
      }
    });
  },
  '/:name': function (req, res) {
    res.render('index', {
      title: 'Hello',
      local: {
        name: req.param.name
      }
    });
  }
});</code></pre>

  <p></p>

  <div class="space-20" id="-cli"></div>
  <h2>CLI (Command Line Interface)</h2>
  <p>webjs support a simple cli to create a mvc web app.</p>
  <pre><code>$ mkdir myapp
$ cd myapp
$ webjs -h
$ webjs init --all --port 8888</code></pre>

  <p>Also you can use the cli to run a simple static server on current directory.</p>
  <pre><code>$ cd sencha-touch-2
$ webjs run 80</code></pre>

  <p>This is full usage of the cli.</p>
  <pre><code>Commands:
  run &lt;port&gt;
  run a simple http server here

  init
  Initialize a webjs app here

Options:
  -h, --help           output usage information
  -V, --version        output the version number
  -c, --cookie         Add cookie support
  -s, --session        Add session support
  -b, --body           Add body parser support
  --compress           Add compress support
  --compiler &lt;engine&gt;  Add compiler support
  -r, --rest           Add more HTTP methods support
  --mustache           Add mustache template engine support (defaults to jade)
  --ejs                Add ejs template engine support (defaults to jade)
  --tmpl &lt;engine&gt;      Set the template engine
  --mode &lt;mode&gt;        Set the mode (defaults to production)
  --port &lt;port&gt;        Set the port (defaults to 80)
  -a --all             Enable all functions

Examples:
  $ webjs
  $ webjs init -s -c -b -r --mode pro --port 8888 --compress --compiler less
  $ webjs init --all
  $ webjs run 8080</code></pre>

  </div>
</section>

<section id="guide" class="page">
  <div class="content">
    <div class="space-20" id="-installation"></div>
    <h1>Installation</h1>
    <p>You can install webjs from npm (Node.js Package Manager).</p>
    <pre><code>$ npm install webjs
$ webjs -v
v0.5.3</code></pre>
    <p>Or you can install the latest version.</p>
    <pre><code>$ npm install webjs@latest</code></pre>
  </div>
</section>

<section id="usage" class="page">
  <h1>Programming</h1>
  <div class="content">
    <p>Congratulations! webjs use the native JavaScript syntax, so you do not need to learn any special syntax.</p>

  <h2 id='-response-data'>Response any data</h2>

  <p>webjs support some extra response methods to make the program send data easier.</p>

  <h3>Plain String</h3>
  <pre><code>res.send('Sending a string');
//You can set the second param as a MIME type string, like 'text/css'.</code></pre>

  <h3>JSON Object</h3>
  <pre><code>res.sendJSON({
  name: 'Will Wen Gunn',
  age: 16,
  contury: 'China',
  languages: ['Chinese', 'Cantonese', 'English', 'Janpanse']
});</code></pre>

  <h3>JSONP (JSON with Padding)</h3>
  <p>webjs will get the callback function from the request.</p>
  <pre><code>res.sendJSONP({
  name: 'Will Wen Gunn',
  age: 16,
  contury: 'China',
  languages: ['Chinese', 'Cantonese', 'English', 'Janpanse']
});</code></pre>

  <h3>Send a file</h3>
  <pre><code>res.sendFile(__dirname + '/test.js')</code></pre>

  <h3>Send a error</h3>
  <p>You can send a http error to client, suck as 404, 500, 503.</p>
  <pre><code>res.sendError(404);
//Just need to set a number.</code></pre>

  <h3>Template render</h3>
  <p>webjs will use the template engine that you set to web controller or the server.</p>
  <pre><code>web.set('view engine', 'jade');
......
res.render('hello', { name: 'Will Wen Gunn' });</code></pre>
  <p>webjs default will create a layout.jade, if you do not need it, you can delete it or do this.</p>
  <pre><code>res.render('hello', {
  name: 'Will Wen Gunn',
  layout: false
});</code></pre>

  <h3>Response pipelining</h3>
  <p>Response pipelining is one of the core of webjs's too. It can be used to compress, compile, data collect, analytics and so on.
  It will be done before the data be sended to clients.</p>
  <h4>Compress</h4>
  <pre><code>var zlib = require('zlib');
web.use(function (req, res, next) {
    res.pipelining(function () {
        var acceptEncoding = req.headers['accept-encoding'] || "";
        var need = /css|js|html/ig.test(res.format);
        if (need && acceptEncoding.match(/\bgzip\b/)) {
            res.header('Content-Encoding', 'gzip');
            res.removeHeader('Content-Length');
            return zlib.createGzip();
        } else if (need && acceptEncoding.match(/\bdeflate\b/)) {
            res.header('Content-Encoding', 'deflate');
            res.removeHeader('Content-Length');
            return zlib.createDeflate();
        }
    });
    next();
});</code></pre>
  <h4>File complier</h4>
  <pre><code>var less = require('less');
//Using dataStream https://github.com/iwillwen/node-dataStream
var dataStream = require('dataStream');

web.use(function (req, res, next) {
  res.pipelining(function () {
    //Check the extname
    if (res.format !== 'less') {
      return;
    } else {
      //Make the stream do not pass on the data(unreadable).
      var complieStream = new dataStream({ readable: false });
      complieStream.on('complate', function () {
        //Reviced all data from the File System
        var body = complieStream.body().toString();
        //complieStream.body() will return a Buffer object
        less.render(body, { path: __dirname }, function (err, css) {
          if (err) return complieStream.emit('data', body);
          res.header('Content-Length', css.length);
          res.header('Content-Type', 'text/css');
          complieStream.emit('data', css);
        });
      });
    }
  });
});</code></pre>

  <h3>This page is still working.</h3>
  </div>
</section>
<section id="about" class="page">
  <div class="content">
    <h1>About</h1>
    <p>webjs by <a href="http://wen.c61.me" title="i-W-Wen">Will Wen Gunn</a></p>
    <p>Released under the MIT license.</p>
    <br>
    <p>This page designed By <a href="http://cloudhead.io">Alexis Sellier</a></p>

    <footer>
        <p>powered by <a href="http://github.com/cloudhead/less.js">LESS</a> and <a href="http://github.com/cloudhead/hijs.">hijs</a></p>
        <p id="copy">Copyright &copy; Will Wen Gunn 甘超阳 2011-2012</p>
    </footer>
  </div>
</section>

    </section>
  <script type="text/javascript" src="/hijs.js"></script>
  </body>
</html>

